import { CodeBlock } from "../components/CodeBlock";
import Box from "../components/Box.jsx"

# Использование key, Fragment, refs

### key

`key` — это уникальный идентификатор, который React использует для определения, какие **элементы списка** изменились, добавились или удалились. Без `key` React **перерисовывает** элементы списка **неэффективно**, что может привести к неожиданному поведению и падению производительности.

Если не указать ключи, в консоли увидим сообщение: 

**`Warning: Each child in an array or iterator should have a unique “key” prop.`**

#### Основные правила использования `key`:

1. **Используй уникальные значения:**

    `key` должен быть уникальным для каждого элемента. Лучше всего использовать стабильные идентификаторы, такие как ID из данных. Если нет ID используй библиотеку [uuid](https://www.npmjs.com/package/uuid):

<CodeBlock code={`const users = [{ id: 1, name: 'Анна' }, { id: 2, name: 'Павел' }];
return users.map((user) => <div key={user.id}>{user.name}</div>)`} language="javascript" />

2. **Не используй индекс массива:**

    Использование индекса как `key` может вызвать баги, особенно при изменении порядка элементов в списке.

    Неправильно:

<CodeBlock code={`items.map((item, index) => <div key={index}>{item}</div>);`} language="javascript" />

3. **Сохраняй стабильность ключей:**

    Убедись, что значение `key` не меняется между рендерами, иначе React будет считать элемент новым и удалять старый.

<Box type="warning" title="Важно!">
- **Используй `key` только там, где это нужно:** React оптимизирует список только при наличии `key`.
- **Не дублируй значения `key`:** Два одинаковых `key` в одном списке приведут к ошибкам.
- **Не добавляй `key` без необходимости:** Не нужно указывать `key` для элементов, которые не являются частью списка.
</Box>

### Fragment

`Fragment` в React — это вспомогательный компонент, который позволяет оборачивать несколько дочерних элементов без добавления лишнего элемента в DOM. Это полезно, если тебе нужно **вернуть несколько элементов, но ты не хочешь создавать дополнительный `<div>`** или другой контейнер.

#### Зачем нужен Fragment?

- **Избегает лишних обёрток в DOM:** Дополнительные контейнеры могут усложнять стилизацию и негативно влиять на производительность.
- **Улучшает читаемость JSX:** Код становится проще и понятнее.

Фрагмент можно использовать двумя способами:
С помощью тега `<React.Fragment>`:

<CodeBlock code={`function App() {
    return (
      <React.Fragment>
        <h1>Hello Child Component</h1>
        <h1>Hello Child Component</h1>
      </React.Fragment>
    );
}`} language="javascript" />

### С помощью короткого синтаксиса (`<>`):

Существует **сокращенная запись** (импортировать не нужно) - недостаток сокращенной записи:нельзя использовать атрибуты, например `id` или  `key`:

<CodeBlock code={`import React, { Fragment } from 'react';

  //так хорошо
  const ChildComponent = () => <>
      <h1>Hello Child Component</h1>
      <h1>Hello Child Component</h1>
  </>

  // так нельзя. Будет ошибка
  const ChildComponent = () => < id="child" >
      <h1>Hello Child Component</h1>
      <h1>Hello Child Component</h1>
</>`} language="javascript" />

### Refs

Refs (сокр. от "references") в React позволяют получить доступ к DOM-элементам или компонентам напрямую. Это своего рода «обходной путь», который даёт тебе возможность взаимодействовать с элементами вне обычного React-потока данных.

Refs полезны в следующих случаях:

1. **Доступ к DOM-элементам:**

    Например, для управления фокусом, выделением текста или выполнения анимаций.

<CodeBlock code={`const inputRef = useRef();

  function focusInput() {
    inputRef.current.focus();
  }

  return (
    <div>
      <input ref={inputRef} type="text" />
      <button onClick={focusInput}>Фокус</button>
    </div>
);`} language="javascript" />

2. **Работа с внешними библиотеками:**

    Например, для интеграции с библиотеками, которые манипулируют DOM напрямую (например, `Chart.js` или `Three.js`).

<Box type="info" title="Официальная документация:">
`key`: https://react.dev/learn/rendering-lists#keeping-list-items-in-order-with-key

`Fragment`: https://react.dev/reference/react/Fragment

Refs: https://react.dev/reference/react/useRef
</Box>


